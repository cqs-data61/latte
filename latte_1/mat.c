/* ****************************** *
 * Implemented by Raymond K. ZHAO *
 *                                *
 * Matrice arithmetic             *
 * ****************************** */
 
#include <stdint.h>
#include <stdlib.h>
#include <string.h>
#include "mat.h"
#include "param.h"
#include "poly.h"
#include "red.h"
#include "fft.h"
#include "ntt.h"

#include <mpc.h>

#define RNS_D 2

static const uint64_t rns_q[RNS_D] = {2147389441, 2147377153};
static const uint64_t rns_montgomery_factor[RNS_D] = {1862176767, 3690881023};
static const uint64_t rns_montgomery_convert_factor[RNS_D] = {1141604340, 269819887};

static const uint64_t rns_root[RNS_D][N] = {{0, 1829943466, 1836298316, 1316983235, 1780194382, 1668674867, 1876898365, 482608607, 1536539100, 240878826, 2072934951, 1507793182, 388886950, 544012720, 623971434, 1537514969, 564156249, 2026329244, 1169238305, 2116218470, 1755677505, 516332411, 2134172303, 1274742716, 10156516, 874196011, 1146980039, 700067736, 1559979991, 472958838, 1857163854, 430993288, 1554664514, 1127812475, 800590259, 1831017538, 2085269795, 1190374405, 917848286, 743950221, 1292001292, 1587294613, 1816925571, 366363604, 1082647155, 1185071803, 1240791685, 1408372324, 617500310, 1082289886, 10922647, 153116756, 1920875162, 891503444, 1432236273, 992755667, 566356501, 2003658946, 498863850, 1423355926, 1915416518, 41125005, 627808605, 2031299840, 683054160, 644325914, 499678143, 1336706381, 1155624913, 994857681, 2032239795, 1992489933, 215226666, 34808368, 1909683994, 889515154, 1302078304, 1532709873, 1366016693, 1601718349, 2022301192, 1587290046, 1937620842, 289781565, 222477407, 468803542, 518431148, 294767756, 1499640124, 137663468, 1614566563, 723325274, 346400867, 520169341, 1560118441, 1256348401, 420255414, 2045145768, 445763958, 1957279431, 1089897312, 1823785559, 1335442474, 628920254, 279364806, 394295299, 964686317, 711507074, 1690049866, 1206461796, 453690225, 551309632, 1889707476, 181265196, 831006161, 5390203, 1031157967, 62957762, 680099046, 1225125850, 1918370150, 1347691183, 1753907129, 1812471308, 227048573, 593194929, 997952947, 583017538, 1440833249, 1325395522, 995751503, 758791449, 188172367, 1595490957, 1092692519, 252120048, 1617750316, 1896464617, 1149396899, 1434711773, 1456425607, 556200145, 1196999469, 856846016, 1943632162, 1932016102, 1771529939, 2004809953, 1617760120, 312942871, 222939007, 211277906, 591793121, 1418587678, 1202513332, 1213649888, 484489363, 51967098, 1395106310, 900003303, 567084680, 1790395392, 2071175318, 780936991, 1752405816, 693637362, 740145789, 650706339, 302883486, 148679578, 911686989, 557316307, 336374168, 1903912849, 615626314, 490189735, 2032388954, 926592571, 734573505, 1483387521, 1357349883, 1083511859, 1267428840, 347329879, 1143121434, 1586578240, 146861552, 1532495907, 2124987676, 1048532778, 1077266041, 1117086595, 689949358, 1068135350, 431710628, 1074622917, 1288317211, 1480936222, 180241586, 421417660, 140818127, 1915163045, 123893560, 1737204941, 703582550, 1073121055, 378838939, 1926843686, 1047812800, 589279768, 1457757792, 1247020075, 1639303227, 349300191, 136285747, 1064141730, 886451495, 281645262, 59919543, 155276342, 29026456, 325545549, 393696585, 579668960, 210745972, 2024600725, 1507975016, 387340488, 400206015, 1623761418, 1343456319, 2101574429, 466920733, 1958554927, 1228886862, 1058433729, 780360398, 1792450489, 900892394, 1258481715, 426713499, 1474683970, 131085194, 1939138799, 1028695955, 242084002, 140605507, 1877846335, 1100147871, 273096450, 2126409091, 1862069753, 2111692429, 1530579988, 568291714, 131985840, 1003496155, 1647402985, 931560424, 1623282579, 1903389091, 1192494857, 2139778950, 523133012, 578148045, 108054268, 1943839217, 779929261, 187567130, 1233240106, 1826914648, 330785322, 349157420, 11273568, 2088408633, 1245375279, 1642596731, 445181866, 640222483, 1380727962, 1485344879, 654678981, 1615857474, 1336203637, 584637099, 411295468, 1885626069, 1260964109, 580493593, 1513525322, 1116263926, 1886720168, 2086527716, 1086446753, 1294031540, 1443688172, 1285013232, 901967352, 1203237258, 939546925, 1214016639, 409021468, 2043372921, 1058152627, 883390189, 493551388, 389568489, 383565368, 397237151, 832432388, 820048426, 885774060, 137663796, 2003585073, 1124260993, 783642587, 2088466763, 974201121, 1211724818, 827383675, 1254109769, 1914948942, 887861792, 2065626072, 1967830391, 1208676475, 1525588909, 94643456, 1848540735, 842250812, 1886819651, 876386489, 1748999278, 700527067, 1739374519, 1325228668, 160938898, 1232859535, 1908829603, 574230485, 1889039614, 128889256, 428580633, 1251143298, 586815366, 983979359, 103683529, 1439527107, 975244445, 1618214863, 1045984294, 9203382, 1384966915, 1164922792, 1508271814, 1347592503, 918789642, 1953875311, 1105947184, 1714608389, 990812625, 837908263, 1586123643, 1167580957, 1550318118, 355689451, 271669567, 885586853, 309986321, 1878559263, 1030824142, 632062282, 1758793692, 1032447117, 964851845, 1342498378, 231445866, 342368698, 792958440, 34959533, 89135815, 687244446, 2143475638, 1335953248, 964487639, 1949598297, 257738458, 1658405004, 87101421, 33866132, 516453656, 212513291, 2090783108, 1578188696, 230647921, 22649291, 1152425856, 1715344274, 1482811363, 1601353271, 1858075840, 2008441088, 1818203951, 10808313, 431597898, 129507061, 62255403, 1162130477, 743767283, 2009648457, 74771973, 1077791439, 640908479, 238871041, 1369859944, 464263469, 1316249001, 1080490145, 460190380, 1044655799, 199560577, 1138794546, 391199045, 1387626260, 2135864202, 1697628854, 37177883, 826722236, 1386411384, 1795258277, 798222235, 1950488085, 1480461342, 1006402752, 263630500, 61953912, 1690738761, 1232533229, 1065869122, 1162915330, 146088019, 1038903044, 341780976, 2069324444, 826050042, 1958502644, 467918430, 1237314953, 36727052, 949489545, 1665222534, 593996630, 246658931, 902073858, 1582107096, 308217284, 1071533715, 322297018, 841593029, 1868529972, 1802998967, 670439288, 1466706083, 453901974, 1596792613, 33614118, 1916038714, 349087247, 150500802, 344188537, 752940833, 154697538, 1888514636, 438111364, 1608203920, 121404176, 2106310373, 1601602748, 2118303190, 683722437, 1297050626, 176431468, 1707213588, 569841682, 343812661, 1973539602, 1678694504, 326476685, 1522490240, 394625844, 1937771236, 1945857990, 1201451834, 421367979, 838341318, 146363541, 1848507395, 145178700, 1540754890, 1333467727, 720369117, 442317435, 801974167, 1194629469, 678922120, 1271864261, 612833486, 1970668877, 643827611, 1343246788, 365322845, 129722976, 677655126, 298282875, 1395418115, 284009530, 300258726, 399026718, 382510332, 1803732898, 427796945, 1544854479, 1273559369, 464935884, 258371998, 725494215, 1761446815, 1201466935, 181959172, 1672237273, 26156780, 1328760851, 1881115117, 576106112, 1139428990, 2080590732, 822307267, 1467953565, 110078146, 496358325, 19247995, 1542178163, 301142961, 577750067, 203294405, 287043649, 6092627, 622602577, 1121594775, 1138213710, 331589734, 1263367198, 1793090743, 742730233, 1276953771, 1829469791, 1418916595, 1177321925, 1898312775, 1633701024, 100067957, 519747549, 265226334, 103281107, 106997942, 1258408982, 262900075, 1518495250, 250149089, 1763685360, 900791668, 753191878, 1679228019, 1812149299, 498846008, 367840055, 152352108, 1786131540, 1384348595, 380734937, 1756045385, 2107159067, 289895897, 549186096, 451440053, 2100164659, 459526429, 1158297688, 640821771, 747017328, 995933539, 544914700, 1540248482, 1884098989, 311179263, 1100588606, 1982674278, 1882755543, 673777687, 271104605, 2112996656, 1564459071, 1518775480, 1975080836, 1332656241, 1952295225, 211938949, 1888873510, 706765073, 1456655195, 423910784, 1236384873, 1654948437, 379578112, 75094808, 698853585, 1980367894, 1103671188, 795916535, 961046890, 1361891519, 2013925057, 1671660768, 326777440, 1473832834, 1007127031, 1610029129, 1188008450, 189894838, 1067709058, 1766124618, 1884400828, 1830906126, 2131178216, 1918083139, 2111855665, 696549428, 1725967527, 423407733, 867627404, 953654908, 1193355515, 1270957094, 91737545, 2086247014, 249407662, 1088256985, 1413586645, 1901949274, 1931883585, 706155338, 832639723, 15933097, 1106425007, 553766683, 1407756856, 1944121174, 1331469270, 374840113, 25376524, 1950864447, 657949688, 184584107, 338328461, 1551695475, 1420045117, 174566115, 501036435, 457465168, 1031951008, 818194854, 1547192269, 947572700, 455728514, 540786346, 884003438, 178693036, 1837084279, 869814370, 990185548, 1055549196, 1342116841, 713892792, 1611719604, 1732566795, 521875044, 965776340, 969170609, 1100900800, 811753482, 418934975, 1722802985, 60576544, 433493384, 1935577880, 463071507, 1041887457, 1099929728, 1415134313, 1497002403, 2015400126, 1837915900, 1301106554, 490356522, 1310382347, 42962209, 1037764812, 1412492680, 1153009459, 1321777575, 321401105, 181238904, 439657024, 724065395, 1062573413, 1406096188, 1692623910, 1496432987, 399504174, 1296871934, 947264425, 1731647556, 1689493122, 987552344, 1673420326, 2131557045, 1033969938, 380648742, 1925832319, 1972106680, 306289979, 2076977586, 2143619481, 397994526, 82971832, 1339218763, 1209446579, 823539991, 1095743319, 31300264, 311568081, 308338715, 1973135524, 1738313289, 10618949, 1729293984, 656884918, 963056129, 1831720766, 1724329394, 1473929688, 957670019, 2134652762, 855801569, 337911392, 1384522064, 470709300, 1928726766, 681632576, 1515281359, 290264462, 598218076, 2075693619, 235431420, 313932494, 5935565, 1900122774, 1839972787, 1031482136, 1584403832, 458068360, 1294765291, 199321555, 958074738, 329505910, 390634596, 772851744, 997372950, 1902392406, 911824306, 207470906, 1833988394, 1164634858, 2136949384, 1500489452, 867256506, 1043024124, 273804599, 657638509, 519536539, 1551186589, 736063170, 1835049310, 274043354, 866615405, 1619589366, 1435976123, 574529072, 1988345751, 1513180857, 1589623570, 1950816712, 1786479022, 2073192949, 498899764, 85596569, 926341728, 643726946, 1723803954, 1595790889, 1952281981, 15343692, 1963115356, 134007049, 2076842566, 1723273426, 737980662, 1914022676, 179895009, 77496865, 1412978837, 884789007, 1508799456, 1575331823, 173928358, 683913421, 1736847062, 684795030, 363617080, 316846537, 1986734606, 1948597245, 463943878, 372293218, 633547358, 874650389, 329434973, 2114012866, 555202488, 1839426393, 407553052, 1953865482, 1125904531, 1399327136, 831584792, 1266486934, 300993160, 1765740623, 438357036, 64650456, 1935125408, 1580266195, 1634347599, 1372825220, 1618889826, 1640156223, 425697703, 1885010806, 617651665, 923323310, 2078252329, 1561764248, 1663639491, 1076965730, 1582773684, 174737898, 729244234, 1369862069, 658178623, 817132520, 1013284789, 1446258571, 1548642213, 577140726, 202288442, 1302550874, 5699694, 143694176, 1957130183, 1011681553, 896045799, 1588814079, 174307020, 2010405410, 1387048505, 188015792, 672940168, 1924982686, 1436988104, 1023518611, 982656561, 469334233, 1596517097, 364399787, 2039377366, 1076699698, 1417164222, 1759039756, 1140061520, 1634104237, 438437910, 57231296, 716467918, 36877713, 206526271, 765993995, 2013631225, 1977195771, 260055940, 179739511, 322258584, 1267265520, 787402577, 2046224021, 620754217, 1563997662, 643098641, 355623087, 2022695761, 1286791925, 860977712, 943516276, 1100071272, 1113174801, 653645145, 1660035253, 1245199973, 752358570, 1222551862, 1775430823, 86612216, 2062571833, 322802261, 1235127002, 1817000159, 1400529963, 1916686064, 355444581, 764934655, 1112803231, 1521974213, 1015175466, 1482152159, 1146712531, 1230387615, 490930367, 519816765, 463925423, 344985544, 1424643552, 880938040, 2135122316, 1756992366, 1926237424, 436148971, 656681218, 652432843, 1811661106, 819600806, 1214027004, 858146988, 1382533297, 1021218996, 22088975, 998028820, 41559673, 1792125582, 1089731404, 1219168775, 1276100632, 283839947, 564350328, 1218090329, 924017223, 539409057, 1619620887, 1398513793, 1054571004, 895299788, 316520048, 58914203, 577335965, 874424904, 698714656, 591662930, 1071437952, 32201227, 1661530915, 379351956, 1905483518, 193218503, 1996955278, 1271856609, 267890848, 1128126656, 1732468852, 1156885260, 496459157, 935069431, 606130843, 828712842, 2140229490, 724670039, 1373305728, 1414778007, 1658679940, 1889912627, 167277719, 1462531801, 1401659402, 1929713629, 1738080194, 1705888413, 1201691419, 1090717985, 88981489, 209446514, 46869354, 789334152, 1582208828, 964368475, 1539039116, 68376751, 122421185},
{0, 734354463, 1388123360, 1354092297, 1108846740, 42043007, 1368529002, 2113303190, 2105946800, 702022815, 1690821082, 307908126, 820483658, 25422689, 523269819, 873427933, 629504857, 673541206, 973599228, 1744484916, 1678909444, 633141735, 1775673133, 620903408, 2052353828, 468816648, 1054806610, 125134422, 636358082, 935665379, 151631320, 1755666977, 1589292108, 99846302, 186755279, 534975624, 1473795477, 1677607002, 683164169, 819751509, 1872450739, 2004822311, 1270358716, 1275166013, 1048540945, 1917047640, 1252723423, 1316204963, 1876175868, 1030419428, 283883283, 516284375, 237687293, 1548875650, 1939899500, 1072014784, 358804162, 1174392634, 1030586601, 1308033716, 1837966414, 688370207, 712907420, 1270044309, 1608043087, 1340262681, 1529241482, 1878857820, 1829308150, 787967740, 751937031, 1583909453, 1225359986, 586225886, 1102573315, 1972314703, 1243734777, 2045340672, 823378737, 219145593, 1656481428, 2141859625, 853030488, 2112683789, 517556518, 527489946, 1828758495, 1608462664, 1650796586, 1773879834, 974948271, 974444022, 1281204854, 764980608, 1265307870, 1617470353, 550614319, 1304029728, 1506004403, 1293065917, 922121851, 763927866, 2075397699, 589894685, 1575009732, 337061272, 2036825509, 2084069284, 1734439437, 556710419, 1896327027, 163436208, 1681341619, 760878321, 415548122, 1591755201, 945657282, 1883455969, 1055060378, 1568907127, 855843526, 812102007, 1768266501, 462489225, 2020778992, 13419152, 2107997216, 1317695521, 1979439780, 486773806, 507894371, 2127918489, 604225595, 807971112, 1661127040, 24589428, 1742999792, 638204355, 1307209771, 1387403015, 500348708, 290332715, 1726533317, 435571553, 1211044194, 263639298, 456517815, 1875135123, 2116207239, 1759034240, 577142755, 1744629959, 1574930602, 1687046245, 286764068, 1008033944, 139049171, 1066970662, 1099847074, 1399351240, 523247325, 387865975, 836718320, 985734273, 1279671348, 1409722612, 342393958, 1226451407, 1272046270, 642177700, 1981442927, 1974571367, 1010317112, 1036067313, 515505918, 1712696099, 610585381, 1224771964, 805560944, 1754141185, 1842247258, 1342352879, 1943268302, 1048612495, 190967409, 586623984, 389565352, 918149445, 909895011, 241528764, 1798201708, 140171666, 819896399, 1642571761, 2081247048, 1689141244, 679545866, 1902921582, 1826316494, 1789855066, 2048409954, 1881561939, 1634846586, 822100723, 635364985, 1601078986, 2026237642, 730586597, 1703701857, 1626182788, 1385641419, 1107500645, 261130053, 716094954, 943506351, 976204971, 1713639561, 697496330, 962435369, 47853761, 780337075, 723273758, 858095289, 483851500, 1982629497, 2109517103, 411412756, 1196412868, 792583457, 933772397, 841726843, 1913296186, 874494128, 947125238, 799578031, 284558717, 1058749068, 1367619552, 486286294, 350318316, 1289325183, 1055534818, 1297398032, 443748426, 1982200738, 358279837, 381957508, 253985678, 928138681, 1612730389, 1771560593, 215955788, 1512620214, 518281481, 1538551346, 1562450292, 727991527, 1644212947, 1664510643, 1941672006, 154790911, 97865468, 1522502475, 894145771, 213291557, 1038317207, 592418570, 318983454, 1082283203, 513415574, 740746645, 1400175036, 726564153, 1324231527, 2071083501, 1780288804, 1037103566, 1820785739, 44038152, 761820397, 2032346499, 171576737, 1217480428, 2075778621, 2331373, 1279686042, 1266843745, 602295290, 2116156238, 1858672795, 651564036, 598993895, 2044890125, 136388377, 1048839223, 1797928033, 518265412, 507836954, 1236724852, 138479897, 1458291038, 1206743224, 1608357295, 1949925268, 89787490, 2072085589, 998232384, 268913544, 1993931699, 1388790811, 454086930, 302037583, 1037120043, 381922427, 525165809, 812201043, 2061790582, 1072322778, 974009473, 515097002, 530034161, 1088192074, 1996523072, 69442261, 854876035, 167551912, 353727194, 827952474, 1049277137, 599325119, 479174197, 1263573415, 2026909991, 490839861, 1789560951, 227039844, 868997626, 2146784310, 973399554, 820579162, 1266811752, 1018308993, 1267676793, 1391945074, 1052041010, 2015554244, 1953000907, 347064316, 1840173252, 2005126780, 1109237877, 922163928, 2056112958, 1646016097, 2108326133, 1547216675, 1976381922, 761842140, 1296078301, 1607674555, 803518223, 107450864, 701505599, 492197404, 464985102, 1754205521, 1931473984, 1030960404, 340706353, 1786740488, 1682098863, 1367933663, 1281408427, 1352053110, 503458890, 1169947917, 1885705283, 1466707887, 1912182264, 265039667, 419858681, 14076576, 1672430362, 479340946, 1924047650, 1630057612, 2039471881, 1985166603, 31074726, 1795509865, 1882857504, 529260726, 1512083436, 1336650361, 802984795, 185349551, 1726721096, 1203518864, 933824839, 1751363742, 1770144478, 534809958, 607695660, 710817749, 652510048, 1152203437, 2118467691, 637736242, 781275188, 2016703987, 19791642, 378876639, 317746915, 1222313500, 1621817592, 222188758, 1600647364, 648080840, 826444033, 273035343, 448179664, 96518426, 918781387, 887543900, 1195478255, 1431680883, 2146684102, 1634949274, 146027152, 891261925, 1500990799, 1417435403, 1292584894, 1863102156, 1492247888, 1697435642, 1376626761, 841534341, 1172272086, 654513947, 1279799483, 2083291966, 57777216, 1502642494, 1779949163, 938991097, 819385706, 1749568661, 1643267068, 1139975146, 106212783, 581559429, 1409379611, 351346973, 987353090, 1642556786, 870554680, 2058470290, 949629274, 1183639449, 1686427276, 314270990, 751259083, 452974092, 957607866, 1748236290, 1836465658, 311965812, 1297468150, 142174859, 1330938223, 1989288749, 384116327, 236914025, 1554310970, 1033809001, 1494154637, 1520201339, 1564922687, 384727323, 1776009022, 1188798182, 816008478, 330381471, 1575319420, 650969657, 1255877486, 452096376, 538263418, 357529644, 1959894345, 921062043, 658910057, 1853027160, 841181766, 291158767, 544291461, 684854607, 1774303527, 36907478, 452896170, 1099642259, 1949959551, 187331207, 1166705211, 1792250426, 1984936794, 438012348, 1724960242, 1981184032, 259292775, 890530873, 978644358, 1001564616, 430967987, 536547692, 1306221682, 559982063, 2146603257, 245506346, 1367974879, 775318638, 1084222414, 546609973, 888787734, 1644250554, 416339902, 1786712758, 1474286579, 86339474, 2021373366, 1127969232, 1033966799, 897699514, 1582136139, 369644707, 968660200, 1606233841, 1002590606, 1875498321, 2132892812, 1184408670, 950693315, 1351989304, 2146277545, 753038479, 1806031953, 61718224, 566738086, 818491832, 895377164, 1116792023, 40098879, 312089920, 1705912049, 902902603, 1401836430, 620205721, 1561943223, 71194661, 414385390, 1205567642, 1323842335, 492177118, 1988427352, 1889850590, 908278109, 2092045052, 672862516, 2023982183, 1019748504, 1111994166, 677332143, 1508654454, 686528634, 635140665, 1471442855, 1813391851, 1349192403, 2005325530, 1462139858, 1686916594, 1739349222, 2041545984, 1765054915, 1981959165, 773718778, 691180237, 1759813028, 1622224946, 1595313463, 156789109, 1499209589, 1767718616, 2000258959, 914456471, 1747369699, 838234765, 760434437, 1112478975, 1702419114, 273253397, 843325794, 453128717, 361110298, 374237307, 1763949558, 1782075792, 615922303, 2106618688, 418333754, 172128602, 138383082, 1051207064, 453605834, 1082863829, 43509923, 1177051348, 1199310837, 322971373, 973648326, 2005863884, 1847982703, 1001249576, 1964519976, 553075008, 1528303081, 1817002692, 1219552678, 720404057, 399926360, 827919182, 442724718, 659294624, 1573344948, 1975358984, 2138778002, 1458109042, 654360297, 1572795915, 1771737311, 1511525708, 1564289653, 1719437224, 1070061730, 1578358984, 155134260, 1362922254, 1655810156, 885251809, 837921601, 2036438729, 927427662, 34833483, 1285785545, 1010088101, 1255322875, 902700585, 370429096, 1803506284, 1918376821, 1531917633, 188214177, 1959878089, 105891052, 953358140, 1770751700, 1942738690, 125810380, 1323660362, 1863393305, 1478767901, 1164555488, 1385915797, 590288179, 185612705, 733711922, 270844499, 889501780, 589664029, 1464354389, 1548750258, 281619442, 554030792, 852582043, 215445960, 1593223154, 485398146, 245541137, 2099549424, 1255728156, 1902555086, 222885895, 1683510423, 912147351, 1956835008, 867025180, 1264428706, 1432707030, 577195555, 1301725062, 450244913, 1340661537, 1180546594, 95097422, 817348222, 1099308670, 1163060578, 459074073, 647799466, 801871175, 880500865, 728961948, 570644382, 2079253088, 1886611054, 2012901997, 1451186439, 1505844982, 569630985, 480675911, 689784101, 1034154401, 655439907, 1300218009, 1076611525, 656490143, 2963158, 1298120745, 375287635, 2048027172, 279655478, 681890578, 175878303, 1968534036, 367273228, 1801859330, 999775346, 1726786643, 533491863, 1280529667, 748717998, 1164292170, 771019521, 752566621, 392515304, 684870713, 982745004, 1940074754, 1291219528, 1827029316, 1137864126, 1676514165, 2110054788, 1652128641, 1503757285, 801534187, 1440756715, 1956871130, 1989194291, 1817412889, 2100222020, 310723529, 85107795, 1057532916, 1590757022, 1607572905, 499707351, 1210793060, 932456164, 2097776850, 962467212, 467299866, 116154154, 1972173217, 834532041, 1226305659, 150934144, 2133250911, 22496785, 457028230, 824485488, 194740792, 1365246853, 1632862627, 1296743169, 529403002, 421964642, 1682922635, 934924870, 708048846, 1248082999, 843401207, 1509947149, 1981244731, 799613541, 1299683043, 1572666382, 1558464535, 2066007299, 1233934610, 1513008441, 1416746514, 1856242559, 1361906095, 2036111614, 1273179657, 82174132, 907705010, 778038597, 1767485905, 41558804, 166887745, 648065984, 2082203364, 172483720, 1988646243, 185937349, 1780851168, 151039589, 1492709885, 638937748, 878765848, 384594382, 1582578127, 1567887318, 1686954525, 481029820, 2051034770, 402604957, 85868677, 471663672, 411249573, 1931420838, 1423776400, 2069521538, 2020286637, 155409808, 1034643903, 1372904506, 1789891693, 742254233, 1508025372, 817149032, 561881461, 1595826149, 510592327, 949895580, 590744786, 1254370030, 401234244, 1092253054, 1261321432, 461791336, 1617190385, 1543639989, 317385207, 1913388830, 841688748, 1715304001, 1557546144, 2106741466, 985960514, 610265117, 1026668525, 1305557622, 1696325014, 2036340268, 56292126, 1731327463, 275046761, 1461940017, 1089047303, 972690813, 1703878986, 1991827352, 340225563, 856384973, 1997911067, 761131179, 1228984005, 2051048926, 288901592, 1246120032, 1358006224, 1794830214, 1292301849, 1001655402, 674802863, 181765285, 1739641629, 879807427, 734417149, 371364344, 179705192, 536317680, 1713305291, 1847969722, 1506752718, 1214207989, 2029323658, 1057044302, 1906315243, 711747309, 1483571582, 78708341, 2072288217, 2055485979, 1997924400, 777440282, 771582944, 41083028, 461960532, 1227662433, 1630173520, 1236107659, 1627995169, 1537229092, 739532600, 1553091911, 17755775, 1976050581, 1167188465, 1013902817, 257352921, 2003922245, 1717490730, 862938007, 684898266, 48171635, 1113392539, 402306308, 870016489, 1873173226, 291660258, 629395717, 1972080700, 1459650738, 1367180849, 404633297, 63753489, 2138684097, 2105537244, 1945138108, 1038750602, 651681127, 30015480, 83331853, 2124561491, 1857547014, 1144128637, 883452576, 2072469522, 668620226, 1761610345, 863553692, 855172623, 460443426, 77908350, 1648534580, 1686893201, 770812301, 1894631517, 192230094, 1850268502, 1653435434, 1229979388, 602149783, 309322770, 1872422502, 438810534, 983693902, 1045462203, 1517348359, 844369031, 1871282646, 385039568, 1720238674, 1240943011, 363230985, 1335628041, 444213295, 860891413, 336043870, 974322914, 1757742968, 536631277, 1916896411, 305624919, 1604457222, 415096658, 1875244826, 353071468, 510642218, 926335206, 624933288, 1838307698, 188772997, 29599263, 336655000, 70723904, 272604296, 1677523900, 1919496741, 1424662378, 1467152607, 135609282, 10661110, 725136577, 1137358473, 979658616, 1742618712, 161566294, 1988085519, 1209484839, 103526302, 1788430227, 456751134, 613629842, 252688037, 1297256465, 244329446, 1403035236, 176139325}};

static const uint64_t rns_inv_n[RNS_D] = {2145292381, 2145280105};

static const uint64_t rns_root_inv[RNS_D][N] = {{0, 1586677593, 830406206, 311091125, 1664780834, 270491076, 478714574, 367195059, 609874472, 1523418007, 1603376721, 1758502491, 639596259, 74454490, 1906510615, 610850341, 1716396153, 290225587, 1674430603, 587409450, 1447321705, 1000409402, 1273193430, 2137232925, 872646725, 13217138, 1631057030, 391711936, 31170971, 978151136, 121060197, 1583233192, 116089601, 1519580836, 2106264436, 231972923, 724033515, 1648525591, 143730495, 1581032940, 1154633774, 715153168, 1255885997, 226514279, 1994272685, 2136466794, 1065099555, 1529889131, 739017117, 906597756, 962317638, 1064742286, 1781025837, 330463870, 560094828, 855388149, 1403439220, 1229541155, 957015036, 62119646, 316371903, 1346799182, 1019576966, 592724927, 1564371903, 1149436494, 1554194512, 1920340868, 334918133, 393482312, 799698258, 229019291, 922263591, 1467290395, 2084431679, 1116231474, 2141999238, 1316383280, 1966124245, 257681965, 1596079809, 1693699216, 940927645, 457339575, 1435882367, 1182703124, 1753094142, 1868024635, 1518469187, 811946967, 323603882, 1057492129, 190110010, 1701625483, 102243673, 1727134027, 891041040, 587271000, 1627220100, 1800988574, 1424064167, 532822878, 2009725973, 647749317, 1852621685, 1628958293, 1678585899, 1924912034, 1857607876, 209768599, 560099395, 125088249, 545671092, 781372748, 614679568, 845311137, 1257874287, 237705447, 2112581073, 1932162775, 154899508, 115149646, 1152531760, 991764528, 810683060, 1647711298, 1503063527, 1464335281, 2015403601, 1579097727, 616809453, 35697012, 285319688, 20980350, 1874292991, 1047241570, 269543106, 2006783934, 1905305439, 1118693486, 208250642, 2016304247, 672705471, 1720675942, 888907726, 1246497047, 354938952, 1367029043, 1088955712, 918502579, 188834514, 1680468708, 45815012, 803933122, 523628023, 1747183426, 1760048953, 639414425, 122788716, 1936643469, 1567720481, 1753692856, 1821843892, 2118362985, 1992113099, 2087469898, 1865744179, 1260937946, 1083247711, 2011103694, 1798089250, 508086214, 900369366, 689631649, 1558109673, 1099576641, 220545755, 1768550502, 1074268386, 1443806891, 410184500, 2023495881, 232226396, 2006571314, 1725971781, 1967147855, 666453219, 859072230, 1072766524, 1715678813, 1079254091, 1457440083, 1030302846, 1070123400, 1098856663, 22401765, 614893534, 2000527889, 560811201, 1004268007, 1800059562, 879960601, 1063877582, 790039558, 664001920, 1412815936, 1220796870, 115000487, 1657199706, 1531763127, 243476592, 1811015273, 1590073134, 1235702452, 1998709863, 1844505955, 1496683102, 1407243652, 1453752079, 394983625, 1366452450, 76214123, 356994049, 1580304761, 1247386138, 752283131, 2095422343, 1662900078, 933739553, 944876109, 728801763, 1555596320, 1936111535, 1924450434, 1834446570, 529629321, 142579488, 375859502, 215373339, 203757279, 1290543425, 950389972, 1591189296, 690963834, 712677668, 997992542, 250924824, 529639125, 1895269393, 1054696922, 551898484, 1959217074, 1388597992, 1151637938, 821993919, 706556192, 2017666465, 1782066596, 804142653, 1503561830, 176720564, 1534555955, 875525180, 1468467321, 952759972, 1345415274, 1705072006, 1427020324, 813921714, 606634551, 2002210741, 298882046, 2001025900, 1309048123, 1726021462, 945937607, 201531451, 209618205, 1752763597, 624899201, 1820912756, 468694937, 173849839, 1803576780, 1577547759, 440175853, 1970957973, 850338815, 1463667004, 29086251, 545786693, 41079068, 2025985265, 539185521, 1709278077, 258874805, 1992691903, 1394448608, 1803200904, 1996888639, 1798302194, 231350727, 2113775323, 550596828, 1693487467, 680683358, 1476950153, 344390474, 278859469, 1305796412, 1825092423, 1075855726, 1839172157, 565282345, 1245315583, 1900730510, 1553392811, 482166907, 1197899896, 2110662389, 910074488, 1679471011, 188886797, 1321339399, 78064997, 1805608465, 1108486397, 2001301422, 984474111, 1081520319, 914856212, 456650680, 2085435529, 1883758941, 1140986689, 666928099, 196901356, 1349167206, 352131164, 760978057, 1320667205, 2110211558, 449760587, 11525239, 759763181, 1756190396, 1008594895, 1947828864, 1102733642, 1687199061, 1066899296, 831140440, 1683125972, 777529497, 1908518400, 1506480962, 1069598002, 2072617468, 137740984, 1403622158, 985258964, 2085134038, 2017882380, 1715791543, 2136581128, 329185490, 138948353, 289313601, 546036170, 664578078, 432045167, 994963585, 2124740150, 1916741520, 569200745, 56606333, 1934876150, 1630935785, 2113523309, 2060288020, 488984437, 1889650983, 197791144, 1182901802, 811436193, 3913803, 1460144995, 2058253626, 2112429908, 1354431001, 1805020743, 1915943575, 804891063, 1182537596, 1114942324, 388595749, 1515327159, 1116565299, 268830178, 1837403120, 1261802588, 1875719874, 1791699990, 597071323, 979808484, 561265798, 1309481178, 1156576816, 432781052, 1041442257, 193514130, 1228599799, 799796938, 639117627, 982466649, 762422526, 2138186059, 1101405147, 529174578, 1172144996, 707862334, 2043705912, 1163410082, 1560574075, 896246143, 1718808808, 2018500185, 258349827, 1573158956, 238559838, 914529906, 1986450543, 822160773, 408014922, 1446862374, 398390163, 1271002952, 260569790, 1305138629, 298848706, 2052745985, 621800532, 938712966, 179559050, 81763369, 1259527649, 232440499, 893279672, 1320005766, 935664623, 1173188320, 58922678, 1363746854, 1023128448, 143804368, 2009725645, 1261615381, 1327341015, 1314957053, 1750152290, 1763824073, 1757820952, 1653838053, 1263999252, 1089236814, 104016520, 1738367973, 933372802, 1207842516, 944152183, 1245422089, 862376209, 703701269, 853357901, 1060942688, 60861725, 260669273, 1031125515, 633864119, 1566895848, 886425332, 261763372, 1736093973, 1562752342, 811185804, 531531967, 1492710460, 662044562, 766661479, 1507166958, 1702207575, 504792710, 902014162, 58980808, 2136115873, 1798232021, 1816604119, 320474793, 914149335, 1959822311, 1367460180, 203550224, 2039335173, 1569241396, 1624256429, 7610491, 954894584, 244000350, 524106862, 1215829017, 499986456, 1143893286, 2024968256, 2079012690, 608350325, 1183020966, 565180613, 1358055289, 2100520087, 1937942927, 2058407952, 1056671456, 945698022, 441501028, 409309247, 217675812, 745730039, 684857640, 1980111722, 257476814, 488709501, 732611434, 774083713, 1422719402, 7159951, 1318676599, 1541258598, 1212320010, 1650930284, 990504181, 414920589, 1019262785, 1879498593, 875532832, 150434163, 1954170938, 241905923, 1768037485, 485858526, 2115188214, 1075951489, 1555726511, 1448674785, 1272964537, 1570053476, 2088475238, 1830869393, 1252089653, 1092818437, 748875648, 527768554, 1607980384, 1223372218, 929299112, 1583039113, 1863549494, 871288809, 928220666, 1057658037, 355263859, 2105829768, 1149360621, 2125300466, 1126170445, 764856144, 1289242453, 933362437, 1327788635, 335728335, 1494956598, 1490708223, 1711240470, 221152017, 390397075, 12267125, 1266451401, 722745889, 1802403897, 1683464018, 1627572676, 1656459074, 917001826, 1000676910, 665237282, 1132213975, 625415228, 1034586210, 1382454786, 1791944860, 230703377, 746859478, 330389282, 912262439, 1824587180, 84817608, 2060777225, 371958618, 924837579, 1395030871, 902189468, 487354188, 1493744296, 1034214640, 1047318169, 1203873165, 1286411729, 860597516, 124693680, 1791766354, 1504290800, 583391779, 1526635224, 101165420, 1359986864, 880123921, 1825130857, 1967649930, 1887333501, 170193670, 133758216, 1381395446, 1940863170, 2110511728, 1430921523, 2090158145, 1708951531, 513285204, 1007327921, 388349685, 730225219, 1070689743, 108012075, 1782989654, 550872344, 1678055208, 1164732880, 1123870830, 710401337, 222406755, 1474449273, 1959373649, 760340936, 136984031, 1973082421, 558575362, 1251343642, 1135707888, 190259258, 2003695265, 2141689747, 844838567, 1945100999, 1570248715, 598747228, 701130870, 1134104652, 1330256921, 1489210818, 777527372, 1418145207, 1972651543, 564615757, 1070423711, 483749950, 585625193, 69137112, 1224066131, 1529737776, 262378635, 1721691738, 507233218, 528499615, 774564221, 513041842, 567123246, 212264033, 2082738985, 1709032405, 381648818, 1846396281, 880902507, 1315804649, 748062305, 1021484910, 193523959, 1739836389, 307963048, 1592186953, 33376575, 1817954468, 1272739052, 1513842083, 1775096223, 1683445563, 198792196, 160654835, 1830542904, 1783772361, 1462594411, 410542379, 1463476020, 1973461083, 572057618, 638589985, 1262600434, 734410604, 2069892576, 1967494432, 233366765, 1409408779, 424116015, 70546875, 2013382392, 184274085, 2132045749, 195107460, 551598552, 423585487, 1503662495, 1221047713, 2061792872, 1648489677, 74196492, 360910419, 196572729, 557765871, 634208584, 159043690, 1572860369, 711413318, 527800075, 1280774036, 1873346087, 312340131, 1411326271, 596202852, 1627852902, 1489750932, 1873584842, 1104365317, 1280132935, 646899989, 10440057, 982754583, 313401047, 1939918535, 1235565135, 244997035, 1150016491, 1374537697, 1756754845, 1817883531, 1189314703, 1948067886, 852624150, 1689321081, 562985609, 1115907305, 307416654, 247266667, 2141453876, 1833456947, 1911958021, 71695822, 1549171365, 1857124979, 632108082, 1465756865, 218662675, 1676680141, 762867377, 1809478049, 1291587872, 12736679, 1189719422, 673459753, 423060047, 315668675, 1184333312, 1490504523, 418095457, 2136770492, 409076152, 174253917, 1839050726, 1835821360, 2116089177, 1051646122, 1323849450, 937942862, 808170678, 2064417609, 1749394915, 3769960, 70411855, 1841099462, 175282761, 221557122, 1766740699, 1113419503, 15832396, 473969115, 1159837097, 457896319, 415741885, 1200125016, 850517507, 1747885267, 650956454, 454765531, 741293253, 1084816028, 1423324046, 1707732417, 1966150537, 1825988336, 825611866, 994379982, 734896761, 1109624629, 2104427232, 837007094, 1657032919, 846282887, 309473541, 131989315, 650387038, 732255128, 1047459713, 1105501984, 1684317934, 211811561, 1713896057, 2086812897, 424586456, 1728454466, 1335635959, 1046488641, 1178218832, 1181613101, 1625514397, 414822646, 535669837, 1433496649, 805272600, 1091840245, 1157203893, 1277575071, 310305162, 1968696405, 1263386003, 1606603095, 1691660927, 1199816741, 600197172, 1329194587, 1115438433, 1689924273, 1646353006, 1972823326, 727344324, 595693966, 1809060980, 1962805334, 1489439753, 196524994, 2122012917, 1772549328, 815920171, 203268267, 739632585, 1593622758, 1040964434, 2131456344, 1314749718, 1441234103, 215505856, 245440167, 733802796, 1059132456, 1897981779, 61142427, 2055651896, 876432347, 954033926, 1193734533, 1279762037, 1723981708, 421421914, 1450840013, 35533776, 229306302, 16211225, 316483315, 262988613, 381264823, 1079680383, 1957494603, 959380991, 537360312, 1140262410, 673556607, 1820612001, 475728673, 133464384, 785497922, 1186342551, 1351472906, 1043718253, 167021547, 1448535856, 2072294633, 1767811329, 492441004, 911004568, 1723478657, 690734246, 1440624368, 258515931, 1935450492, 195094216, 814733200, 172308605, 628613961, 582930370, 34392785, 1876284836, 1473611754, 264633898, 164715163, 1046800835, 1836210178, 263290452, 607140959, 1602474741, 1151455902, 1400372113, 1506567670, 989091753, 1687863012, 47224782, 1695949388, 1598203345, 1857493544, 40230374, 391344056, 1766654504, 763040846, 361257901, 1995037333, 1779549386, 1648543433, 335240142, 468161422, 1394197563, 1246597773, 383704081, 1897240352, 628894191, 1884489366, 888980459, 2040391499, 2044108334, 1882163107, 1627641892, 2047321484, 513688417, 249076666, 970067516, 728472846, 317919650, 870435670, 1404659208, 354298698, 884022243, 1815799707, 1009175731, 1025794666, 1524786864, 2141296814, 1860345792, 1944095036, 1569639374, 1846246480, 605211278, 2128141446, 1651031116, 2037311295, 679435876, 1325082174, 66798709, 1007960451, 1571283329, 266274324, 818628590, 2121232661, 475152168, 1965430269, 945922506, 385942626, 1421895226, 1889017443, 1682453557, 873830072, 602534962, 1719592496, 343656543, 1764879109, 1748362723, 1847130715, 1863379911, 751971326, 1849106566, 1469734315},
{0, 14472351, 793284856, 759253793, 34073963, 778848151, 2105334146, 1038530413, 1273949220, 1624107334, 2121954464, 1326893495, 1839469027, 456556071, 1445354338, 41430353, 391710176, 1995745833, 1211711774, 1511019071, 2022242731, 1092570543, 1678560505, 95023325, 1526473745, 371704020, 1514235418, 468467709, 402892237, 1173777925, 1473835947, 1517872296, 877332844, 1434469733, 1459006946, 309410739, 839343437, 1116790552, 972984519, 1788572991, 1075362369, 207477653, 598501503, 1909689860, 1631092778, 1863493870, 1116957725, 271201285, 831172190, 894653730, 230329513, 1098836208, 872211140, 877018437, 142554842, 274926414, 1327625644, 1464212984, 469770151, 673581676, 1612401529, 1960621874, 2047530851, 558085045, 829681632, 39379937, 2133958001, 126598161, 1684887928, 379110652, 1335275146, 1291533627, 578470026, 1092316775, 263921184, 1201719871, 555621952, 1731829031, 1386498832, 466035534, 1983940945, 251050126, 1590666734, 412937716, 63307869, 110551644, 1810315881, 572367421, 1557482468, 71979454, 1383449287, 1225255302, 854311236, 641372750, 843347425, 1596762834, 529906800, 882069283, 1382396545, 866172299, 1172933131, 1172428882, 373497319, 496580567, 538914489, 318618658, 1619887207, 1629820635, 34693364, 1294346665, 5517528, 490895725, 1928231560, 1323998416, 102036481, 903642376, 175062450, 1044803838, 1561151267, 922017167, 563467700, 1395440122, 1359409413, 318069003, 268519333, 618135671, 807114472, 539334066, 584926861, 608825807, 1629095672, 634756939, 1931421365, 375816560, 534646764, 1219238472, 1893391475, 1765419645, 1789097316, 165176415, 1703628727, 849979121, 1091842335, 858051970, 1797058837, 1661090859, 779757601, 1088628085, 1862818436, 1347799122, 1200251915, 1272883025, 234080967, 1305650310, 1213604756, 1354793696, 950964285, 1735964397, 37860050, 164747656, 1663525653, 1289281864, 1424103395, 1367040078, 2099523392, 1184941784, 1449880823, 433737592, 1171172182, 1203870802, 1431282199, 1886247100, 1039876508, 761735734, 521194365, 443675296, 1416790556, 121139511, 546298167, 1512012168, 1325276430, 512530567, 265815214, 98967199, 357522087, 321060659, 244455571, 1467831287, 458235909, 66130105, 504805392, 1327480754, 2007205487, 349175445, 1905848389, 1237482142, 1229227708, 1757811801, 1560753169, 1956409744, 1098764658, 204108851, 805024274, 305129895, 393235968, 1341816209, 922605189, 1536791772, 434681054, 1631871235, 1111309840, 1137060041, 172805786, 165934226, 1505199453, 875330883, 920925746, 1804983195, 737654541, 867705805, 1161642880, 1310658833, 1759511178, 1624129828, 748025913, 1047530079, 1080406491, 2008327982, 1139343209, 1860613085, 460330908, 572446551, 402747194, 1570234398, 388342913, 31169914, 272242030, 1690859338, 1883737855, 936332959, 1711805600, 420843836, 1857044438, 1647028445, 759974138, 840167382, 1509172798, 404377361, 2122787725, 486250113, 1339406041, 1543151558, 19458664, 1639482782, 1660603347, 167937373, 1256846280, 1888084378, 166193121, 422416911, 1709364805, 162440359, 355126727, 980671942, 1960045946, 197417602, 1047734894, 1694480983, 2110469675, 373073626, 1462522546, 1603085692, 1856218386, 1306195387, 294349993, 1488467096, 1226315110, 187482808, 1789847509, 1609113735, 1695280777, 891499667, 1496407496, 572057733, 1816995682, 1331368675, 958578971, 371368131, 1762649830, 582454466, 627175814, 653222516, 1113568152, 593066183, 1910463128, 1763260826, 158088404, 816438930, 2005202294, 849909003, 1835411341, 310911495, 399140863, 1189769287, 1694403061, 1396118070, 1833106163, 460949877, 963737704, 1197747879, 88906863, 1276822473, 504820367, 1160024063, 1796030180, 737997542, 1565817724, 2041164370, 1007402007, 504110085, 397808492, 1327991447, 1208386056, 367427990, 644734659, 2089599937, 64085187, 867577670, 1492863206, 975105067, 1305842812, 770750392, 449941511, 655129265, 284274997, 854792259, 729941750, 646386354, 1256115228, 2001350001, 512427879, 693051, 715696270, 951898898, 1259833253, 1228595766, 2050858727, 1699197489, 1874341810, 1320933120, 1499296313, 546729789, 1925188395, 525559561, 925063653, 1829630238, 1768500514, 2127585511, 130673166, 1366101965, 1509640911, 28909462, 995173716, 1494867105, 1436559404, 1539681493, 1612567195, 377232675, 396013411, 1213552314, 943858289, 420656057, 1962027602, 1344392358, 810726792, 635293717, 1618116427, 264519649, 351867288, 2116302427, 162210550, 107905272, 517319541, 223329503, 1668036207, 474946791, 2133300577, 1727518472, 1882337486, 235194889, 680669266, 261671870, 977429236, 1643918263, 795324043, 865968726, 779443490, 465278290, 360636665, 1806670800, 1116416749, 215903169, 393171632, 1682392051, 1655179749, 1445871554, 2039926289, 1343858930, 539702598, 851298852, 1385535013, 170995231, 600160478, 39051020, 501361056, 91264195, 1225213225, 1038139276, 142250373, 307203901, 1800312837, 194376246, 131822909, 1095336143, 755432079, 879700360, 1129068160, 880565401, 1326797991, 1173977599, 592843, 1278379527, 1920337309, 357816202, 1656537292, 120467162, 883803738, 1668202956, 1548052034, 1098100016, 1319424679, 1793649959, 1979825241, 1292501118, 2077934892, 150854081, 1059185079, 1617342992, 1632280151, 1173367680, 1075054375, 85586571, 1335176110, 1622211344, 1765454726, 1110257110, 1845339570, 1693290223, 758586342, 153445454, 1878463609, 1149144769, 75291564, 2057589663, 197451885, 539019858, 940633929, 689086115, 2008897256, 910652301, 1639540199, 1629111741, 349449120, 1098537930, 2010988776, 102487028, 1548383258, 1495813117, 288704358, 31220915, 1545081863, 880533408, 867691111, 2145045780, 71598532, 929896725, 1975800416, 115030654, 1385556756, 2103339001, 326591414, 1110273587, 367088349, 76293652, 823145626, 1420813000, 747202117, 1406630508, 1633961579, 1065093950, 1828393699, 1554958583, 1109059946, 1934085596, 1253231382, 624874678, 2049511685, 1992586242, 205705147, 482866510, 503164206, 1419385626, 1971237828, 744341917, 1903047707, 850120688, 1894689116, 1533747311, 1690626019, 358946926, 2043850851, 937892314, 159291634, 1985810859, 404758441, 1167718537, 1010018680, 1422240576, 2136716043, 2011767871, 680224546, 722714775, 227880412, 469853253, 1874772857, 2076653249, 1810722153, 2117777890, 1958604156, 309069455, 1522443865, 1221041947, 1636734935, 1794305685, 272132327, 1732280495, 542919931, 1841752234, 230480742, 1610745876, 389634185, 1173054239, 1811333283, 1286485740, 1703163858, 811749112, 1784146168, 906434142, 427138479, 1762337585, 276094507, 1303008122, 630028794, 1101914950, 1163683251, 1708566619, 274954651, 1838054383, 1545227370, 917397765, 493941719, 297108651, 1955147059, 252745636, 1376564852, 460483952, 498842573, 2069468803, 1686933727, 1292204530, 1283823461, 385766808, 1478756927, 74907631, 1263924577, 1003248516, 289830139, 22815662, 2064045300, 2117361673, 1495696026, 1108626551, 202239045, 41839909, 8693056, 2083623664, 1742743856, 780196304, 687726415, 175296453, 1517981436, 1855716895, 274203927, 1277360664, 1745070845, 1033984614, 2099205518, 1462478887, 1284439146, 429886423, 143454908, 1890024232, 1133474336, 980188688, 171326572, 2129621378, 594285242, 1407844553, 610148061, 519381984, 911269494, 517203633, 919714720, 1685416621, 2106294125, 1375794209, 1369936871, 149452753, 91891174, 75088936, 2068668812, 663805571, 1435629844, 241061910, 1090332851, 118053495, 933169164, 640624435, 299407431, 434071862, 1611059473, 1967671961, 1776012809, 1412960004, 1267569726, 407735524, 1965611868, 1472574290, 1145721751, 855075304, 352546939, 789370929, 901257121, 1858475561, 96328227, 918393148, 1386245974, 149466086, 1290992180, 1807151590, 155549801, 443498167, 1174686340, 1058329850, 685437136, 1872330392, 416049690, 2091085027, 111036885, 451052139, 841819531, 1120708628, 1537112036, 1161416639, 40635687, 589831009, 432073152, 1305688405, 233988323, 1829991946, 603737164, 530186768, 1685585817, 886055721, 1055124099, 1746142909, 893007123, 1556632367, 1197481573, 1636784826, 551551004, 1585495692, 1330228121, 639351781, 1405122920, 357485460, 774472647, 1112733250, 1991967345, 127090516, 77855615, 723600753, 215956315, 1736127580, 1675713481, 2061508476, 1744772196, 96342383, 1666347333, 460422628, 579489835, 564799026, 1762782771, 1268611305, 1508439405, 654667268, 1996337564, 366525985, 1961439804, 158730910, 1974893433, 65173789, 1499311169, 1980489408, 2105818349, 379891248, 1369338556, 1239672143, 2065203021, 874197496, 111265539, 785471058, 291134594, 730630639, 634368712, 913442543, 81369854, 588912618, 574710771, 847694110, 1347763612, 166132422, 637430004, 1303975946, 899294154, 1439328307, 1212452283, 464454518, 1725412511, 1617974151, 850633984, 514514526, 782130300, 1952636361, 1322891665, 1690348923, 2124880368, 14126242, 1996443009, 921071494, 1312845112, 175203936, 2031222999, 1680077287, 1184909941, 49600303, 1214920989, 936584093, 1647669802, 539804248, 556620131, 1089844237, 2062269358, 1836653624, 47155133, 329964264, 158182862, 190506023, 706620438, 1345842966, 643619868, 495248512, 37322365, 470862988, 1009513027, 320347837, 856157625, 207302399, 1164632149, 1462506440, 1754861849, 1394810532, 1376357632, 983084983, 1398659155, 866847486, 1613885290, 420590510, 1147601807, 345517823, 1780103925, 178843117, 1971498850, 1465486575, 1867721675, 99349981, 1772089518, 849256408, 2144413995, 1490887010, 1070765628, 847159144, 1491937246, 1113222752, 1457593052, 1666701242, 1577746168, 641532171, 696190714, 134475156, 260766099, 68124065, 1576732771, 1418415205, 1266876288, 1345505978, 1499577687, 1688303080, 984316575, 1048068483, 1330028931, 2052279731, 966830559, 806715616, 1697132240, 845652091, 1570181598, 714670123, 882948447, 1280351973, 190542145, 1235229802, 463866730, 1924491258, 244822067, 891648997, 47827729, 1901836016, 1661979007, 554153999, 1931931193, 1294795110, 1593346361, 1865757711, 598626895, 683022764, 1557713124, 1257875373, 1876532654, 1413665231, 1961764448, 1557088974, 761461356, 982821665, 668609252, 283983848, 823716791, 2021566773, 204638463, 376625453, 1194019013, 2041486101, 187499064, 1959162976, 615459520, 229000332, 343870869, 1776948057, 1244676568, 892054278, 1137289052, 861591608, 2112543670, 1219949491, 110938424, 1309455552, 1262125344, 491566997, 784454899, 1992242893, 569018169, 1077315423, 427939929, 583087500, 635851445, 375639842, 574581238, 1493016856, 689268111, 8599151, 172018169, 574032205, 1488082529, 1704652435, 1319457971, 1747450793, 1426973096, 927824475, 330374461, 619074072, 1594302145, 182857177, 1146127577, 299394450, 141513269, 1173728827, 1824405780, 948066316, 970325805, 2103867230, 1064513324, 1693771319, 1096170089, 2008994071, 1975248551, 1729043399, 40758465, 1531454850, 365301361, 383427595, 1773139846, 1786266855, 1694248436, 1304051359, 1874123756, 444958039, 1034898178, 1386942716, 1309142388, 400007454, 1232920682, 147118194, 379658537, 648167564, 1990588044, 552063690, 525152207, 387564125, 1456196916, 1373658375, 165417988, 382322238, 105831169, 408027931, 460460559, 685237295, 142051623, 798184750, 333985302, 675934298, 1512236488, 1460848519, 638722699, 1470045010, 1035382987, 1127628649, 123394970, 1474514637, 55332101, 1239099044, 257526563, 158949801, 1655200035, 823534818, 941809511, 1732991763, 2076182492, 585433930, 1527171432, 745540723, 1244474550, 441465104, 1835287233, 2107278274, 1030585130, 1251999989, 1328885321, 1580639067, 2085658929, 341345200, 1394338674, 1099608, 795387849, 1196683838, 962968483, 14484341, 271878832, 1144786547, 541143312, 1178716953, 1777732446, 565241014, 1249677639, 1113410354, 1019407921, 126003787, 2061037679, 673090574, 360664395, 1731037251, 503126599, 1258589419, 1600767180, 1063154739, 1372058515, 779402274, 1901870807, 773896, 1587395090, 841155471, 1610829461, 1716409166, 1145812537, 1168732795}};

static const uint64_t t1_inv_t2 = 1431934294;
static const uint64_t t1 = 4611255024196841473LL;

/* Compute the Gram matrix a * (a*)^T */
void gram(MAT_FFT *out, const MAT_64 *basis, const uint64_t dim, const uint64_t n)
{
	uint64_t i, j, k, p;
	static MAT_64 ntt_basis[RNS_D], g_ntt[RNS_D];
	uint64_t d;

	for (d = 0; d < RNS_D; d++)
	{
		memcpy(ntt_basis + d, basis, sizeof(MAT_64));
		for (i = 0; i < dim; i++)
		{
			for (j = 0; j < dim; j++)
			{
				ntt_core(ntt_basis[d].mat[i][j].poly, rns_root[d], rns_q[d], rns_montgomery_factor[d], rns_montgomery_convert_factor[d]);
			}
		}
	}
	
	memset(g_ntt, 0, sizeof(g_ntt));
	for (d = 0; d < RNS_D; d++)
	{
		for (i = 0; i < dim; i++)
		{
			for (j = 0; j < dim; j++)
			{
				for (k = 0; k < dim; k++)
				{
					for (p = 0; p < N; p++)
					{
						g_ntt[d].mat[i][j].poly[p] = con_sub(g_ntt[d].mat[i][j].poly[p] + montgomery_core(ntt_basis[d].mat[i][k].poly[p], ntt_basis[d].mat[j][k].poly[N - p - 1], rns_q[d], rns_montgomery_factor[d]), rns_q[d]);
					}
				}
				intt_core(g_ntt[d].mat[i][j].poly, rns_root_inv[d], rns_q[d], rns_montgomery_factor[d], rns_inv_n[d]);
			}
		}
	}
	
	for (i = 0; i < dim; i++)
	{
		for (j = 0; j < dim; j++)
		{
			for (p = 0; p < N; p++)
			{
				g_ntt[0].mat[i][j].poly[p] += rns_q[0] * montgomery_core(t1_inv_t2, con_add(g_ntt[1].mat[i][j].poly[p] - con_sub(g_ntt[0].mat[i][j].poly[p], rns_q[1]), rns_q[1]), rns_q[1], rns_montgomery_factor[1]);

				if (g_ntt[0].mat[i][j].poly[p] > (t1 >> 1))
				{
					g_ntt[0].mat[i][j].poly[p] -= t1;
				}
				mpc_set_si(out->mat[i][j].poly[p], g_ntt[0].mat[i][j].poly[p], MPC_RNDNN);				
			}
			fft(&(out->mat[i][j]), N);
		}
	}
}
